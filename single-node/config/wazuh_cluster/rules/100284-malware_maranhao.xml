<group name="maranhao,malware,">
  <rule id="100284" level="12">
    <if_sid>61609</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)[^"]*\.tmp[^"]*\.tmp</field>
    <field name="win.eventdata.ImageLoaded" type="pcre2">(?i)[^"]*\.tmp[^"]*\.tmp</field>
    <description>Possible Maranhao malware activity: Detection of double .tmp in command line - possible masquerading</description>
    <mitre>
      <id>T1036</id>
    </mitre>
  </rule>

  <rule id="100285" level="12">
    <if_sid>61609</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)\.tmp</field>
    <field name="win.eventdata.ImageLoaded" type="pcre2">(?i)isdecmp.dll</field>
    <description>Possible Maranhao malware activity: isdecmp.dll loaded by .tmp file</description>
    <mitre>
      <id>T1574.002</id>
    </mitre>
  </rule>

  <rule id="100286" level="15">
    <if_sid>92302</if_sid>
    <field name="win.eventdata.TargetObject" type="pcre2">Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run</field>
    <field name="win.eventdata.details" type="pcre2">updater\.exe</field>
    <description>Maranhao malware activity: $(win.eventdata.details) added to the Run Registry to establish persistence.</description>
    <mitre>
      <id>T1547.001</id>
    </mitre>
  </rule>
  
  <rule id="100287" level="15">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)attrib\.exe</field>
    <field name="win.eventdata.CommandLine" type="pcre2">(?i)\+h.*\+s|\+s.*\+h</field>
    <field name="win.eventdata.CommandLine" type="pcre2">crypto|infoprocess</field>
    <description>Maranhao malware activity: attrib.exe used to hide a file with +h +s attributes in  $(win.eventdata.CurrentDirectory)</description>
    <mitre>
      <id>T1564.001</id>
    </mitre>   
  </rule>
  
  <rule id="100288" level="15">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)cmd\.exe</field>
    <field name="win.eventdata.CommandLine" type="pcre2">(?i)wmic.*(os|cpu|csproduct|win32_VideoController|logicaldisk).*get.*(Caption|Name|UUID|FreeSpace|Size|Description)</field>
    <field name="win.eventdata.ParentImage" type="pcre2">(?i)updater\.exe</field>
    <description>Maranhao malware activity: System fingerprinting via wmic command: $(win.eventdata.commandLine)</description>
    <mitre>
      <id>T1082</id>
      <id>T1059.003</id>
    </mitre>   
  </rule>  

  <rule id="100289" level="15">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)powershell\.exe</field>
    <field name="win.eventdata.CommandLine" type="pcre2">(?i)Get-ItemProperty.*SoftwareProtectionPlatform.*BackupProductKeyDefault</field>
    <description>Maranhao malware activity: Malicious PowerShell command to retrieve Windows product key from registry</description>
    <mitre>
      <id>T1552.002</id>
      <id>T1059.001</id>
    </mitre>   
  </rule>  

  <rule id="100290" level="15">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.Image" type="pcre2">(?i)\.exe</field>
    <field name="win.eventdata.CommandLine" type="pcre2">(?i)Get-Volume.*DriveLetter</field>
    <field name="win.eventdata.ParentImage" type="pcre2">(?i)updater\.exe</field>
    <description>Maranhao malware activity: Disk volume enumeration via PowerShell: $(win.eventdata.commandLine)</description>
    <mitre>
      <id>T1082</id>
      <id>T1059.001</id>
    </mitre>   
  </rule>  
</group>