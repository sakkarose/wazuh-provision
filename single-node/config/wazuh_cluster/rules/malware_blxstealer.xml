<group name="windows,sysmon,blx_detection_rule,">
<!-- Blx drops powershell script -->
  <rule id="100300" level="10">
    <if_sid>92200</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)\\\\.+(exe|dll|bat|msi)</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)\\\\temp.ps1</field>
    <description>Possible BLX stealer activity detected: A rogue powershell script was dropped to system.</description>
    <mitre>
      <id>T1105</id>
    </mitre>
  </rule>

<!-- Blx starts a command prompt to execute previously dropped script -->
  <rule id="100310" level="10">
    <if_sid>92052</if_sid>
    <field name="win.eventdata.parentImage" type="pcre2">(?i)\\\\.+(exe|dll|bat|msi)</field>
    <field name="win.eventdata.image" type="pcre2">(?i)\\\\Windows\\\\System32\\\\cmd.exe</field>
    <field name="win.eventdata.commandLine" type="pcre2">powershell.exe -ExecutionPolicy Bypass -File</field>
    <description>Possible BLX stealer activity detected: Rogue powershell script execution.</description>
    <mitre>
      <id>T1059.003</id>
    </mitre>
  </rule>

<!-- Blx dropped an executable to temp folder -->
  <rule id="100320" level="10">
    <if_sid>92213</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)\\\\.+(exe|dll|bat|msi)</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)\\\\Users\\\\[^\\\\]+\\\\AppData\\\\Local\\\\Temp\\\\decrypted_executable.exe</field>
    <description>Possible BLX stealer activity detected: Rogue executable was dropped to system.</description>
    <mitre>
      <id>T1105</id>
    </mitre>
  </rule>

<!-- Rogue executable copies itself to users' startup folder for persistence -->
  <rule id="100330" level="10">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)\\\\Users\\\\[^\\\\]+\\\\AppData\\\\Local\\\\Temp\\\\decrypted_executable.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)\\\\Users\\\\[^\\\\]+\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\decrypted_executable.exe</field>
    <description>Possible BLX stealer persistence activity detected: Rogue executable was copied to users' startup folder to establish persistence.</description>
    <mitre>
      <id>T1547.001</id>
    </mitre>
  </rule>
</group>