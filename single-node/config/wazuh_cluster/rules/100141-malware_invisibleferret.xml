<group name="invisibleferret,malware">

  <rule id="100141" level="7">
    <if_sid>100015</if_sid>
    <field name="eventdata.image" type="pcre2">\/usr\/bin\/python(\d+\.\d+).*?</field>
    <field name="eventdata.targetFilename" type="pcre2">\/tmp\/([a-zA-Z0-9]{8}).*?</field>
    <description>Suspicious file created: "$(eventdata.targetFilename)"- Possible InvisibleFerret malware activity detected.</description>
    <mitre>
      <id>T1044</id>
    </mitre>
  </rule>

  <rule id="100142" level="7">
    <if_sid>100017</if_sid>
    <field name="eventdata.image" type="pcre2">\/usr\/bin\/python(\d+\.\d+).*?</field>
    <field name="eventdata.targetFilename" type="pcre2">\/tmp\/([a-zA-Z0-9]{8}).*?</field>
    <description>Suspicious file deleted: "$(eventdata.targetFilename)" - Possible InvisibleFerret malware activity detected.</description>
    <mitre>
      <id>T1107</id>
      <id>T1485</id>
    </mitre>
  </rule>
   
  <rule id="100143" level="7">
    <if_sid>100012</if_sid>
    <field name="eventdata.image" type="pcre2">\/usr\/bin\/python(\d+\.\d+).*?</field>
    <field name="eventdata.destinationIp" type="pcre2">(127\.0\.0\.1)</field>
    <field name="eventdata.sourceIp" type="pcre2">(127\.0\.0\.53)</field>
    <field name="eventdata.sourcePort" type="pcre2">(53)</field>
    <description>Suspicious query of DNS - Possible InvisibleFerret malware activity detected.</description>
    <mitre>
      <id>T1043</id>
    </mitre>
  </rule>

  <rule id="100144" level="12">
    <if_sid>100012</if_sid>
    <field name="eventdata.image" type="pcre2">\/usr\/bin\/python(\d+\.\d+).*?</field>
    <field name="eventdata.sourceIp" type="pcre2">(\d+\.\d+\.\d+\.\d+)</field>
    <field name="eventdata.destinationIp" type="pcre2">(151\.101\.\d+\.\d+)</field>
    <field name="eventdata.destinationPort" type="pcre2">443</field>
    <description>Suspicious download request to "$(eventdata.destinationIp)" for remote access - InvisibleFerret malware activity detected.</description>
    <mitre>
      <id>T1043</id>
    </mitre>
  </rule>

 <rule id="100145" level="12">
    <if_sid>100012</if_sid>
    <field name="eventdata.image" type="pcre2">\/usr\/bin\/python(\d+\.\d+).*?</field>
    <field name="eventdata.sourceIp" type="pcre2">(\d+\.\d+\.\d+\.\d+)</field>
    <field name="eventdata.destinationIp" type="pcre2">(208\.95\.\d+\.\d+)</field>
    <field name="eventdata.destinationPort" type="pcre2">80</field>
    <description>Suspicious download request to "$(eventdata.destinationIp)" for data exfiltration - InvisibleFerret malware activity detected.</description>
    <mitre>
      <id>T1043</id>
    </mitre>
  </rule>

  <rule id="100146" level="13">
    <if_sid>554,550</if_sid>
    <list field="sha256" lookup="match_key">etc/lists/malware_invisibleferret</list>
    <description>A known InvisibleFerret malware hash detected: $(file)</description>
    <mitre>
      <id>T1204.002</id>
    </mitre>
  </rule>

  <rule id="100147" level="12">
   <if_sid>657</if_sid>
    <match>Successfully removed threat</match>
    <description>$(parameters.program): Successfully removed threat $(parameters.alert.syscheck.path) whose hash appears in a malware blacklist.</description>
  </rule>

  <rule id="100148" level="12">
   <if_sid>657</if_sid>
    <match>Error removing threat</match>
    <description>$(parameters.program): Error removing threat $(parameters.alert.syscheck.path) whose hash appears in a malware blacklist.</description>
  </rule>
</group>