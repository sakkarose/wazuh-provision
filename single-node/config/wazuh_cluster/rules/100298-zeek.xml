<group name="zeek,">
  <rule id="100298" level="0">
    <decoded_as>json</decoded_as>
    <description>Zeek alerts</description>
  </rule>

  <rule id="100299" level="5">
    <if_sid>100298</if_sid>
    <field name="dnsquery">\w+.</field>
    <dstport type="pcre2">^53$</dstport>
    <field name="resolved_by">\d+.\d+.\d+.\d+</field>
    <description>Zeek: DNS Query $(dnsquery) attempted from source ip $(srcip) source port $(srcport) resolved to IP(s) $(resolved_by)</description>
  </rule>

  <rule id="100300" level="0">
    <if_sid>100298</if_sid>
    <srcport>5353</srcport>
    <description>Zeek: Normal mDNS traffic - $(dnsquery) from source ip $(srcip). Generally benign. Investigate only if the source is unexpected. </description>
  </rule>

  <rule id="100301" level="7">
    <if_sid>100298</if_sid>
    <field name="connection_state">REJ</field>
    <description>Zeek: Connection from $(srcip) to $(dstip) $(dstport) rejected</description>
  </rule>

  <rule id="100302" level="10" frequency="5" timeframe="20">
    <if_matched_sid>100301</if_matched_sid>
    <description>Zeek: Multiple rejected connections from $(srcip) (5+ in 20s - possible port scan activity)</description>
  </rule>

<!-- Suppresses alerts for DNS queries to the Wazuh CTI domain. -->
  <rule id="100303" level="0">
    <if_sid>100298</if_sid>
    <field name="dnsquery">cti.wazuh.com</field>
    <description>Zeek: DNS Query $(dnsquery) exclude</description>
  </rule>

  <rule id="100304" level="8">
    <if_sid>100298</if_sid>
    <field name="ssl_validation_status">self signed certificate</field>
    <description>Zeek: Client $(srcip) connected to a server with self-signed certificate $(dstip)</description>
  </rule>

  <rule id="100305" level="12">
    <if_sid>100298</if_sid>
    <field name="ssl_validation_status">certificate has expired</field>
    <description>Zeek: Client $(srcip) connected to a server with expired certificate $(dstip)</description>
  </rule>
</group>