<group name="sosano, malware,">
<!-- The LNK file uses mshta.exe to execute the PDF/HTA polyglot file -->
 <rule id="100154" level="12">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image">\\mshta.exe$</field>
    <regex type="pcre2" field="win.eventdata.commandLine">(?i)C:\\.*\\electronica-2024\.pdf</regex>
    <description>Suspicious execution: mshta.exe running electronica-2024.pdf detected.Potential Sosano malware activity detected.</description>
    <mitre>
      <id>T1218.005</id> <!-- MITRE ATT&CK: Mshta Abuse -->
    </mitre>
  </rule>

<!-- Malware loads the second PDF file -->
  <rule id="100155" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\14s.pdf$</field>
    <description>The process $(win.eventdata.image) loads file $(win.eventdata.targetFilename) associated with Sosano backdoor malware.</description>
  </rule>

<!-- Malware looks for a file named sosano.jpg -->
  <rule id="100156" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\sosano.jpg$</field>
    <description>The process $(win.eventdata.image) looks for file $(win.eventdata.targetFilename). Activity associated with Sosano backdoor malware detected.</description>
  </rule>
  
  <!-- Malware looks for a file named hyper.jpg -->
  <rule id="100157" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\hyper.jpg$</field>
    <description>The process $(win.eventdata.image) looks for file $(win.eventdata.targetFilename). Activity associated with Sosano backdoor malware detected.</description>
  </rule>

<!-- Malware loads Hyper-info.exe -->
  <rule id="100158" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\Hyper-info.exe$</field>
    <description>The process $(win.eventdata.image) loads $(win.eventdata.targetFilename). Activity associated with Sosano backdoor malware detected.</description>
  </rule>

<!-- Malware extract the OrderList.xlsx LNK file -->
  <rule id="100159" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\OrderList.xlsx$</field>
    <description>The process $(win.eventdata.image) extracts file $(win.eventdata.targetFilename). Activity associated with Sosano backdoor malware detected.</description>
  </rule>

<!-- Malware writes URL file to the registry runkey for persistence -->
  <rule id="100160" level="12">
    <if_sid>92300</if_sid>
    <field name="win.eventdata.eventType" type="pcre2">SetValue</field>
    <field name="win.eventdata.targetObject" type="pcre2">HKU\\\\S-1-5-21-\d+-\d+-\d+-\d+\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\MyUrlFile$</field>
    <field name="win.eventdata.details" type="pcre2">(?i)[C-Z]:\\\\Windows\\\\Tasks\\\\youtube.url$</field>
    <description>Sosano backdoor malware added URL file $(win.eventdata.targetObject) to registry runkey to be executed on next logon. Sosano backdoor malware activity detected.</description>
  </rule>

  <rule id="100161" level="13">
    <if_sid>554,550</if_sid>
    <list field="sha256" lookup="match_key">etc/lists/malware_sosano</list>
    <description>A known Sosano backdoor malware hash detected: $(file)</description>
    <mitre>
      <id>T1204.002</id>
    </mitre>
  </rule>
  <rule id="100162" level="12">
    <if_sid>657</if_sid>
      <match>Successfully removed threat</match>
      <description>$(parameters.program): Successfully removed threat $(parameters.alert.syscheck.path) whose hash appears in a malware blacklist.</description>
  </rule>
  <rule id="100163" level="12">
    <if_sid>657</if_sid>
      <match>Error removing threat</match>
      <description>$(parameters.program): Error removing threat $(parameters.alert.syscheck.path) whose hash appears in a malware blacklist.</description>
  </rule>
</group>