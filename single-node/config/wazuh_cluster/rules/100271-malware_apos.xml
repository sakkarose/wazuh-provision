<group name="Apos, malware,">

<!-- Malware creates a file to check file creation access -->
  <rule id="100271" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:.*\__tmp_rar_sfx_access_check</field>
    <description>File $(win.eventdata.targetFilename) created by $(win.eventdata.image). Activity associated with Apos malware detected.</description>
  </rule>

<!-- Detects multiple DLLs creation by the malware-->
  <rule id="100272" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)(libffi-8\.dll|libgcc_s_dw2-1\.dll|libgio-2\.0-0\.dll|libglib-2\.0-0\.dll|libgmodule-2\.0-0\.dll|libgobject-2\.0-0\.dll|libiconv-2\.dll|libintl-8\.dll|libpcre2-8-0\.dll|libwinpthread-1\.dll|zlib1\.dll)$</field>
    <description>The DLL $(win.eventdata.targetFilename) was created by $(win.eventdata.image). Activity associated with Apos malware detected.</description>
  </rule>

<!-- Malware creates Update.exe executable file -->
  <rule id="100273" level="12">
    <if_sid>61613</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\.exe</field>
    <field name="win.eventdata.targetFilename" type="pcre2">(?i)[C-Z]:.*\\Update.exe$</field>
    <description>An executable file $(win.eventdata.targetFilename) was created. Activity associated with Apos malware detected.</description>
  </rule>

<!-- Malware executes Update.exe application -->
  <rule id="100274" level="12">
    <if_sid>61603</if_sid>
    <regex type="pcre2" field="win.eventdata.commandLine">(?i)C:\\.*\\Update\.exe</regex>
    <field name="win.eventdata.hashes" type="pcre2">(?i)SHA256=3DA500D9DC1A24E1C4A55146A1DD85088C07CDE5CB684F1AD4238B78B74CD5C1|A0027DF5CCC2A66C8A0BCAA7D7033AA438B58A92732030E73D5A9F77A7659639</field>
    <description>A malicious executable $(win.eventdata.image) was launched. Activity associated with Apos malware detected.</description>
    <mitre>
      <id>T1036</id>
    </mitre>
  </rule> 

<!-- Malware loads Update.exe image -->
  <rule id="100275" level="12">
    <if_sid>61609</if_sid>
    <field name="win.eventdata.imageLoaded" type="pcre2">(?i)[C-Z]:.*\\Update.exe</field>
    <field name="win.eventdata.hashes" type="pcre2">(?i)SHA256=3DA500D9DC1A24E1C4A55146A1DD85088C07CDE5CB684F1AD4238B78B74CD5C1|A0027DF5CCC2A66C8A0BCAA7D7033AA438B58A92732030E73D5A9F77A7659639</field>
    <description>A malicious image $(win.eventdata.imageLoaded) was loaded. Activity associated with Apos malware detected.</description>
    <mitre>
      <id>T1073</id>
    </mitre>
  </rule>  

<!-- Update.exe application loads the DLLs created by parent process -->
  <rule id="100276" level="12">
    <if_sid>61609</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)[C-Z]:.*\\Update.exe</field>
    <field name="win.eventdata.imageLoaded" type="pcre2">(?i)[C-Z]:.*\.dll</field>
    <description>DLL $(win.eventdata.imageLoaded) was loaded by a malicious executable $(win.eventdata.image). Activity associated with Apos malware detected.</description>
    <mitre>
      <id>T1073</id>
    </mitre>
  </rule>

</group>