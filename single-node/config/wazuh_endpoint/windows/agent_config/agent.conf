<agent_config>
<!-- Windows only section -->

    <localfile>
        <location>Microsoft-Windows-Sysmon/Operational</location>
        <log_format>eventchannel</log_format>
    </localfile>

    <localfile>
        <location>Microsoft-Windows-PowerShell/Operational</location>
        <log_format>eventchannel</log_format>
    </localfile>

    <!-- Add whodata="yes" to every directories entry -->
    <syscheck>
        <directories whodata="yes" check_all="yes" realtime="yes">C:\Users\*\Downloads</directories>
        <directories whodata="yes" check_all="yes" realtime="yes">C:\Users\*\Desktop</directories>
        <directories whodata="yes" check_all="yes" realtime="yes">C:\Users\*\Documents</directories>
        <directories whodata="yes" check_all="yes" realtime="yes">%WINDIR%/System32</directories>
        <directories whodata="yes" check_all="yes" realtime="yes">%WINDIR%/SysWOW64</directories>
        <directories whodata="yes" realtime="yes" restrict="\Adobe-Hub">C:\Users\*\Appdata\Local</directories>

        <windows_registry arch="both" report_changes="yes">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</windows_registry>
        <windows_registry arch="both" report_changes="yes">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</windows_registry>

        <whodata>
            <provider>ebpf</provider>
            <queue_size>50000</queue_size>
        </whodata>
    </syscheck>

    <!-- Hyper-V logs -->
    <localfile>
        <log_format>eventchannel</log_format>
        <location>Microsoft-Windows-Hyper-V-VMMS-Admin</location>
    </localfile>

    <localfile>
        <log_format>eventchannel</log_format>
        <location>Microsoft-Windows-Hyper-V-VMMS-Networking</location>
    </localfile>

    <localfile>
        <log_format>eventchannel</log_format>
        <location>Microsoft-Windows-Hyper-V-VMMS-Analytic</location>
    </localfile>

    <localfile>
        <log_format>eventchannel</log_format>
        <location>Microsoft-Windows-Hyper-V-Worker-Admin</location>
    </localfile>

    <wodle name="command">
        <disabled>yes</disabled>
        <tag>hyper-v_metrics</tag>
        <command>PowerShell.exe -ExecutionPolicy Bypass -File "C:\Program Files (x86)\ossec-agent\wodles\hyper-v_metrics.ps1"</command>
        <interval>1m</interval>
        <ignore_output>no</ignore_output>
        <run_on_start>yes</run_on_start>
        <timeout>0</timeout>
    </wodle>

    <wodle name="command">
        <disabled>no</disabled>
        <tag>vss</tag>
        <command>C:\Windows\SysNative\WindowsPowerShell\v1.0\powershell.exe -c "net stop VSS ; sc.exe config VSS start=Demand ; net start VSS ; WMIC shadowcopy call create Volume=C:\ ; net stop VSS ; sc.exe config VSS start=disabled"</command>
        <interval>12h</interval>
        <run_on_start>yes</run_on_start>
        <timeout>300</timeout>
    </wodle>

    <sca>
        <policies>
            <policy>C:\Program Files (x86)\sca_policies\trojan_snake.yml</policy>
            <policy>C:\Program Files (x86)\sca_policies\malware_purehvnc.yml</policy>
        </policies>
    </sca>

<!-- Sharable -->

    <!-- System inventory -->
    <wodle name="syscollector">
        <disabled>no</disabled>
        <interval>1h</interval>
        <scan_on_start>yes</scan_on_start>
        <hardware>yes</hardware>
        <os>yes</os>
        <network>yes</network>
        <packages>yes</packages>
        <ports all="no">yes</ports>
        <processes>yes</processes>

    <!-- Database synchronization settings -->
        <synchronization>
            <max_eps>10</max_eps>
        </synchronization>
    </wodle>

</agent_config>
